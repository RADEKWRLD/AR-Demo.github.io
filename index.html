<!DOCTYPE html>
<html>
<head>
    <title>AR.js Interactive Game</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ar.js@latest/aframe/build/aframe-ar.min.js"></script>
    <style>
        #scoreboard {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            display: none;
            z-index: 10;
        }

        #timer {
            position: fixed;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            display: none;
            z-index: 10;
        }

        #start-button {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 20px;
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: none;
            z-index: 20;
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <div id="scoreboard">Score: 0</div>
    <div id="timer">Time: 30</div>
    <button id="start-button">Start Game</button>
    
    <a-scene embedded arjs cursor="rayOrigin: mouse">
        <a-assets>
            <audio id="sound" src="assets/clickSound.mp3"></audio>
        </a-assets>

        <a-marker id="marker" type="pattern" url="assets/pattern-images.patt">
            <a-entity id="model" gltf-model="assets/yellow_duck.glb" position="0 -0.5 0" scale="0.5 0.5 0.5"
                gesture-detector="enabled: false" class="clickable"></a-entity>
        </a-marker>

        <a-camera position="0 0 0" raycaster="objects: .clickable"></a-camera>
    </a-scene>

    <script>
        let score = 0;
        let timeLeft = 30;
        let gameActive = false;
        let moveInterval;

        const model = document.getElementById("model");
        const scoreDisplay = document.getElementById("scoreboard");
        const timerDisplay = document.getElementById("timer");
        const startButton = document.getElementById("start-button");
        const sound = document.getElementById("sound");
        const marker = document.getElementById("marker");

        function startGame() {
            if (!marker.object3D.visible) return;
            gameActive = true;
            score = 0;
            timeLeft = 30;
            scoreDisplay.innerText = "Score: 0";
            timerDisplay.innerText = "Time: 30";
            scoreDisplay.style.display = "block";
            timerDisplay.style.display = "block";
            startButton.style.display = "none";
            startTimer();
            moveDuck();
            moveInterval = setInterval(moveDuck, 1000);
        }

        function updateScore() {
            if (!gameActive) return;
            score += 10;
            scoreDisplay.innerText = `Score: ${score}`;
        }

        function moveDuck() {
            if (!gameActive) return;
            const newX = (Math.random() - 0.5) * 2;
            const newY = (Math.random() * 0.5) - 0.5;
            const newZ = (Math.random() - 0.5) * 2;
            model.setAttribute("position", `${newX} ${newY} ${newZ}`);
        }

        model.addEventListener("raycaster-intersected", () => {
            if (!gameActive) return;
            updateScore();
            moveDuck();
            sound.currentTime = 0;
            sound.play().catch(() => {});
        });

        function startTimer() {
            const timerInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    timerDisplay.innerText = `Time: ${timeLeft}`;
                } else {
                    clearInterval(timerInterval);
                    clearInterval(moveInterval);
                    gameActive = false;
                    alert(`Game Over! Final Score: ${score}`);
                    startButton.style.display = "block";
                }
            }, 1000);
        }

        marker.addEventListener("markerFound", () => {
            startButton.style.display = "block";
        });

        marker.addEventListener("markerLost", () => {
            startButton.style.display = "none";
        });

        startButton.addEventListener("click", startGame);
    </script>
</body>
</html>
